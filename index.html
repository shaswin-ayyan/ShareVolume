<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Amgen (AMGN) - Stock Shares Outstanding</title>
<!-- Bootstrap 5 CSS -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-ENjdO4Dr2bkBIFxQpeo1F7l4H4z/3p+2fV0ZT+eUEMh0NQ0K0b7U7m+7Qv5kXK0" crossorigin="anonymous">
</head>
<body class="bg-light">
<div class="container py-4">
<h1 class="text-center mb-4" id="entity-title">Loading...</h1>
<div class="card mx-auto" style="max-width: 600px;">
<div class="card-body">
<h5 class="card-title">Stock Shares Outstanding Data</h5>
<table class="table table-striped">
<tbody>
<tr>
<th scope="row">Entity Name</th>
<td id="share-entity-name">-</td>
</tr>
<tr>
<th scope="row">Max Shares</th>
<td>
Val: <span id="share-max-value">-</span><br />
FY: <span id="share-max-fy">-</span>
</td>
</tr>
<tr>
<th scope="row">Min Shares</th>
<td>
Val: <span id="share-min-value">-</span><br />
FY: <span id="share-min-fy">-</span>
</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<!-- UID -->
<script>
// Embed the UID from uid.txt
const uid = "24464216365243098907972610300624022712169376524035847542618892567189386972627";
</script>
<!-- Bootstrap 5 JS Bundle -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js" integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+7G8gU4hXU0Q7iKk8nyk7Fd0aR0w" crossorigin="anonymous"></script>
<!-- Main JavaScript -->
<script>
// Utility to parse URL parameters
function getQueryParam(param) {
  const urlParams = new URLSearchParams(window.location.search);
  return urlParams.get(param);
}

// Initialize
async function init() {
  const cikParam = getQueryParam('CIK');

  // Determine CIK to use
  let cik = cikParam;

  // If no CIK param, default to Amgen
  if (!cik) {
    cik = '0000318154';
  }

  // Build URL
  let fetchUrl;
  if (cik !== '0000318154') {
    // Use proxy or CORS workaround if needed, here using https://aipipe.org/ for example
    fetchUrl = `https://aipipe.org/api/https://data.sec.gov/api/xbrl/companyconcept/CIK${cik}/dei/EntityCommonStockSharesOutstanding.json`;
  } else {
    fetchUrl = `https://data.sec.gov/api/xbrl/companyconcept/CIK0000318154/dei/EntityCommonStockSharesOutstanding.json`;
  }

  try {
    // Fetch data with custom User-Agent
    const response = await fetch(fetchUrl, {
      headers: {
        'User-Agent': 'MyApp/1.0 (contact@example.com)'
      }
    });
    if (!response.ok) {
      throw new Error(`Network response was not ok: ${response.status}`);
    }
    const data = await response.json();
    // Save data.json in local storage
    localStorage.setItem('data', JSON.stringify(data));
    processData(data);
  } catch (error) {
    console.error('Fetch error:', error);
    document.getElementById('entity-title').textContent = 'Error loading data.';
  }
}

function processData(data) {
  // Extract entityName
  const entityName = data.entityName || 'Unknown Entity';
  // Update the title and header
  document.title = `${entityName} - Stock Shares Outstanding`;
  document.getElementById('entity-title').textContent = entityName;

  // Find shares units with fy > 2020 and numeric val
  const sharesUnits = data.units?.shares || [];
  const filteredShares = sharesUnits.filter(unit => {
    const fyStr = unit.fy;
    const fyNum = parseInt(fyStr);
    return fyNum > 2020 && !isNaN(unit.val);
  });

  if (filteredShares.length === 0) {
    // Handle no data
    document.getElementById('share-max-value').textContent = 'N/A';
    document.getElementById('share-max-fy').textContent = 'N/A';
    document.getElementById('share-min-value').textContent = 'N/A';
    document.getElementById('share-min-fy').textContent = 'N/A';
    return;
  }

  // Find max and min val
  let maxEntry = filteredShares[0];
  let minEntry = filteredShares[0];
  filteredShares.forEach(entry => {
    if (entry.val > maxEntry.val) {
      maxEntry = entry;
    } else if (entry.val < minEntry.val) {
      minEntry = entry;
    }
  });

  // Update DOM
  document.getElementById('share-entity-name').textContent = entityName;
  document.getElementById('share-max-value').textContent = maxEntry.val;
  document.getElementById('share-max-fy').textContent = maxEntry.fy;
  document.getElementById('share-min-value').textContent = minEntry.val;
  document.getElementById('share-min-fy').textContent = minEntry.fy;
}

// Run on page load
window.addEventListener('DOMContentLoaded', init);
</script>
</body>
</html>